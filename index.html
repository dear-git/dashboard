<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Battery Monitoring System - Thailand</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes ping {
      75%, 100% {
        transform: scale(2);
        opacity: 0;
      }
    }
    .animate-ping {
      animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
    }
    @keyframes float {
      0%, 100% { transform: translate(-50%, -100%) translateY(0px); }
      50% { transform: translate(-50%, -100%) translateY(-8px); }
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes grid {
      0% { transform: translateY(0); }
      100% { transform: translateY(20px); }
    }
    
    /* Enhanced body background with animated gradient */
    body {
      background: linear-gradient(-45deg, #0f172a, #1e293b, #0f172a, #1e293b, #0f172a);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      position: relative;
      overflow-x: hidden;
    }
    
    /* Animated grid pattern background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: grid 10s linear infinite;
      z-index: -2;
    }
    
    /* Particle effect background */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(239, 68, 68, 0.2) 0%, transparent 50%);
      z-index: -1;
    }
    
    .map-bg {
      position: absolute;
      inset: 0;
      background-image: url('https://z-cdn-media.chatglm.cn/files/870aa00a-185a-40b6-8ffe-7906ee26926a_icon.jpg?auth_key=1791557113-d2bfbafb9e28420f8bebc9aba93f5448-0-e5f2330290aee6a6b42c57f592d73024');
      background-size: 85%;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.9;
      filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
    }
    
    .map-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, 
        rgba(15, 23, 42, 0.1) 0%, 
        rgba(15, 23, 42, 0.2) 25%, 
        rgba(15, 23, 42, 0.3) 50%, 
        rgba(15, 23, 42, 0.2) 75%, 
        rgba(15, 23, 42, 0.1) 100%);
    }
    
    .battery-pin {
      position: absolute;
      transform: translate(-50%, -100%);
      cursor: pointer;
      transition: all 0.3s ease;
      animation: float 2.5s ease-in-out infinite;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
    }
    
    .battery-pin:hover {
      z-index: 100 !important;
      animation: none;
      transform: translate(-50%, -100%) scale(1.2);
      filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.6));
    }
    
    .pin-circle {
      width: 24px;
      height: 24px;
      border: 3px solid white;
      border-radius: 50%;
      display: block;
      position: relative;
      z-index: 2;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .pin-stem {
      width: 3px;
      height: 12px;
      display: block;
      margin: 0 auto;
      transform: translateY(-2px);
      border-radius: 1.5px;
    }
    
    .pin-good { 
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
    }
    .pin-warning { 
      background: linear-gradient(135deg, #eab308, #ca8a04);
      box-shadow: 0 0 20px rgba(234, 179, 8, 0.5);
    }
    .pin-critical { 
      background: linear-gradient(135deg, #ef4444, #dc2626);
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
    }
    
    /* Glass morphism effect for cards */
    .glass-card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    
    /* Enhanced header background */
    .header-bg {
      background: linear-gradient(135deg, 
        rgba(15, 23, 42, 0.9) 0%, 
        rgba(30, 41, 59, 0.8) 50%, 
        rgba(15, 23, 42, 0.9) 100%);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }
    
    /* Map container enhanced background */
    .map-container {
      background: linear-gradient(135deg, 
        rgba(15, 23, 42, 0.95) 0%, 
        rgba(30, 41, 59, 0.9) 100%);
      position: relative;
      overflow: hidden;
    }
    
    .map-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Enhanced button hover effects */
    .btn-enhanced {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .btn-enhanced::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn-enhanced:hover::before {
      width: 300px;
      height: 300px;
    }
    
    /* Status indicators with glow effect */
    .status-good {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
      border: 1px solid rgba(34, 197, 94, 0.3);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
    }
    
    .status-warning {
      background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
      border: 1px solid rgba(234, 179, 8, 0.3);
      box-shadow: 0 0 20px rgba(234, 179, 8, 0.2);
    }
    
    .status-critical {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      border: 1px solid rgba(239, 68, 68, 0.3);
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
    }
  </style>
</head>
<body class="text-white min-h-screen">
  <div id="app"></div>

  <script>
    // Site data
    const sites = [
      { id: 1, name: 'Bangkok Central', lat: 13.7563, lng: 100.5018, status: 'good', battery: 95, temp: 28, voltage: 48.2, current: 12.5, power: 603 },
      { id: 2, name: 'Chiang Mai North', lat: 18.7883, lng: 98.9853, status: 'good', battery: 92, temp: 26, voltage: 48.0, current: 11.8, power: 566 },
      { id: 3, name: 'Phuket West', lat: 7.8804, lng: 98.3923, status: 'warning', battery: 78, temp: 32, voltage: 47.5, current: 10.2, power: 485 },
      { id: 4, name: 'Pattaya East', lat: 12.9236, lng: 100.8825, status: 'good', battery: 88, temp: 29, voltage: 48.1, current: 12.0, power: 577 },
      { id: 5, name: 'Khon Kaen', lat: 16.4322, lng: 102.8236, status: 'critical', battery: 45, temp: 38, voltage: 46.8, current: 8.5, power: 398 },
      { id: 6, name: 'Hat Yai South', lat: 7.0087, lng: 100.4653, status: 'good', battery: 91, temp: 30, voltage: 48.3, current: 11.5, power: 555 },
      { id: 7, name: 'Nakhon Ratchasima', lat: 14.9799, lng: 102.0977, status: 'good', battery: 89, temp: 27, voltage: 48.0, current: 12.2, power: 586 },
      { id: 8, name: 'Udon Thani', lat: 17.4138, lng: 102.7872, status: 'warning', battery: 72, temp: 33, voltage: 47.7, current: 9.8, power: 467 },
      { id: 9, name: 'Surat Thani', lat: 9.1382, lng: 99.3331, status: 'good', battery: 94, temp: 28, voltage: 48.2, current: 12.8, power: 617 },
      { id: 10, name: 'Chonburi', lat: 13.3611, lng: 100.9847, status: 'good', battery: 87, temp: 29, voltage: 48.1, current: 11.9, power: 572 },
      { id: 11, name: 'Rayong Industrial', lat: 12.6814, lng: 101.2816, status: 'good', battery: 93, temp: 27, voltage: 48.3, current: 12.6, power: 609 },
      { id: 12, name: 'Ayutthaya', lat: 14.3692, lng: 100.5877, status: 'warning', battery: 68, temp: 35, voltage: 47.4, current: 9.2, power: 436 },
      { id: 13, name: 'Krabi', lat: 8.0863, lng: 98.9063, status: 'good', battery: 90, temp: 29, voltage: 48.0, current: 11.7, power: 562 },
      { id: 14, name: 'Nakhon Si Thammarat', lat: 8.4304, lng: 99.9631, status: 'good', battery: 85, temp: 30, voltage: 47.9, current: 11.3, power: 541 },
      { id: 15, name: 'Lampang', lat: 18.2888, lng: 99.4919, status: 'critical', battery: 42, temp: 39, voltage: 46.5, current: 7.8, power: 363 },
      { id: 16, name: 'Saraburi', lat: 14.5289, lng: 100.9100, status: 'good', battery: 88, temp: 28, voltage: 48.1, current: 12.1, power: 582 },
      { id: 17, name: 'Prachuap Khiri Khan', lat: 11.8123, lng: 99.7970, status: 'good', battery: 91, temp: 29, voltage: 48.2, current: 11.8, power: 569 },
      { id: 18, name: 'Kanchanaburi', lat: 14.0227, lng: 99.5328, status: 'warning', battery: 75, temp: 31, voltage: 47.6, current: 10.5, power: 500 },
      { id: 19, name: 'Phitsanulok', lat: 16.8214, lng: 100.2659, status: 'good', battery: 86, temp: 28, voltage: 48.0, current: 11.6, power: 557 },
      { id: 20, name: 'Songkhla', lat: 7.1906, lng: 100.5960, status: 'good', battery: 89, temp: 30, voltage: 48.1, current: 12.0, power: 577 },
      { id: 21, name: 'Nakhon Pathom', lat: 13.8199, lng: 100.0376, status: 'good', battery: 92, temp: 27, voltage: 48.2, current: 12.3, power: 593 },
      { id: 22, name: 'Trang', lat: 7.5563, lng: 99.6114, status: 'warning', battery: 70, temp: 34, voltage: 47.5, current: 9.5, power: 451 },
      { id: 23, name: 'Buriram', lat: 15.0000, lng: 103.1000, status: 'good', battery: 87, temp: 29, voltage: 48.0, current: 11.9, power: 571 },
      { id: 24, name: 'Sukhothai', lat: 17.0078, lng: 99.8236, status: 'good', battery: 90, temp: 27, voltage: 48.1, current: 12.2, power: 587 }
    ];

    let currentPage = 'home';
    let selectedSite = null;

    function getStatusColor(status) {
      switch(status) {
        case 'good': return 'text-green-500';
        case 'warning': return 'text-yellow-500';
        case 'critical': return 'text-red-500';
        default: return 'text-gray-500';
      }
    }

    function getStatusBg(status) {
      switch(status) {
        case 'good': return 'bg-green-500';
        case 'warning': return 'bg-yellow-500';
        case 'critical': return 'bg-red-500';
        default: return 'bg-gray-500';
      }
    }

    function getStatusClass(status) {
      switch(status) {
        case 'good': return 'status-good';
        case 'warning': return 'status-warning';
        case 'critical': return 'status-critical';
        default: return '';
      }
    }

    function exportToCSV() {
      const headers = ['Site ID', 'Site Name', 'Status', 'Battery Level (%)', 'Temperature (°C)', 'Voltage (V)', 'Current (A)', 'Power (W)', 'Latitude', 'Longitude', 'Timestamp'];
      const timestamp = new Date().toISOString();
      const rows = sites.map(site => [
        site.id, site.name, site.status, site.battery, site.temp, 
        site.voltage, site.current, site.power, site.lat, site.lng, timestamp
      ]);
      
      const csvContent = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      const dateStr = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `battery_monitoring_data_${dateStr}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function renderBatteryPin(site) {
      const pinClass = site.status === 'good' ? 'pin-good' : 
                       site.status === 'warning' ? 'pin-warning' : 'pin-critical';
      
      return `
        <div class="pin-circle ${pinClass}"></div>
        <div class="pin-stem ${pinClass}"></div>
      `;
    }

    function renderHomePage() {
      const statusCounts = sites.reduce((acc, site) => {
        acc[site.status] = (acc[site.status] || 0) + 1;
        return acc;
      }, {});

      return `
        <div class="header-bg p-4">
          <div class="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-3">
              <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-2 rounded-lg shadow-lg">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="5" y="6" width="14" height="12" rx="2" stroke-width="2"/>
                  <path d="M12 6V2M8 2h8" stroke-width="2"/>
                </svg>
              </div>
              <div>
                <h1 class="text-2xl font-bold">Battery Monitoring System</h1>
                <p class="text-sm text-gray-400">Thailand Network - 24 Sites</p>
              </div>
            </div>
            <div class="flex gap-4 flex-wrap">
              <button onclick="exportToCSV()" class="btn-enhanced flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 px-5 py-2 rounded-lg transition-all shadow-lg hover:shadow-xl">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                <span class="font-semibold">Export Data</span>
              </button>
              <div class="status-good flex items-center gap-2 px-4 py-2 rounded-lg">
                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span class="font-semibold">${statusCounts.good || 0} Good</span>
              </div>
              <div class="status-warning flex items-center gap-2 px-4 py-2 rounded-lg">
                <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <span class="font-semibold">${statusCounts.warning || 0} Warning</span>
              </div>
              <div class="status-critical flex items-center gap-2 px-4 py-2 rounded-lg">
                <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <span class="font-semibold">${statusCounts.critical || 0} Critical</span>
              </div>
            </div>
          </div>
        </div>

        <div class="max-w-7xl mx-auto p-6">
          <div class="mb-6">
            <h2 class="text-2xl font-bold mb-2">Thailand Sites Overview</h2>
            <p class="text-gray-400">Click on any battery icon to view detailed information</p>
          </div>

          <div class="glass-card rounded-xl p-6">
            <div class="map-container rounded-lg overflow-hidden relative" style="height: 700px;">
              <!-- Map background -->
              <div class="map-bg"></div>
              <div class="map-overlay"></div>
              
              ${sites.map(site => {
                const x = ((site.lng - 97) / (106 - 97)) * 100;
                const y = ((20 - site.lat) / (20 - 5)) * 100;
                return `
                  <div class="battery-pin" 
                       style="left: ${x}%; top: ${y}%;"
                       onclick="showDetail(${site.id})">
                    ${renderBatteryPin(site)}
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-1 whitespace-nowrap opacity-0 hover:opacity-100 transition-opacity pointer-events-none z-20">
                      <div class="glass-card rounded-lg px-3 py-2">
                        <div class="font-bold text-sm text-center text-white">${site.name}</div>
                        <div class="text-xs text-gray-300 text-center mt-1">
                          Battery: <span class="font-bold ${getStatusColor(site.status)}">${site.battery}%</span>
                        </div>
                        <div class="text-xs text-gray-300 text-center">
                          ${site.province}
                        </div>
                        <div class="text-xs text-blue-400 text-center mt-2 font-semibold">
                          Click for details →
                        </div>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>

          <div class="mt-6 glass-card rounded-xl p-4">
            <h3 class="font-bold mb-3">Legend</h3>
            <div class="flex flex-wrap gap-6">
              <div class="flex items-center gap-2">
                <div class="pin-circle pin-good" style="width: 16px; height: 16px;"></div>
                <span class="text-sm">Good Status (≥80%)</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="pin-circle pin-warning" style="width: 16px; height: 16px;"></div>
                <span class="text-sm">Warning Status (60-79%)</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="pin-circle pin-critical" style="width: 16px; height: 16px;"></div>
                <span class="text-sm">Critical Status (&lt;60%)</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderDetailPage() {
      if (!selectedSite) return '';
      
      const x = ((selectedSite.lng - 97) / (106 - 97)) * 100;
      const y = ((20 - selectedSite.lat) / (20 - 5)) * 100;
      const circumference = 2 * Math.PI * 112;
      const offset = circumference * (1 - selectedSite.battery / 100);

      return `
        <div class="header-bg p-4">
          <div class="max-w-7xl mx-auto">
            <button onclick="showHome()" class="flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-4 transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
              </svg>
              <span>Back to All Sites</span>
            </button>
            <div class="flex items-center justify-between flex-wrap gap-4">
              <div class="flex items-center gap-3">
                <div class="${getStatusBg(selectedSite.status)} p-3 rounded-lg shadow-lg">
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                  </svg>
                </div>
                <div>
                  <h1 class="text-3xl font-bold">${selectedSite.name}</h1>
                  <p class="text-gray-400">Site ID: ${selectedSite.id}</p>
                </div>
              </div>
              <div class="${getStatusClass(selectedSite.status)} flex items-center gap-2 px-6 py-3 rounded-lg">
                <span class="${getStatusColor(selectedSite.status)} font-semibold text-xl capitalize">${selectedSite.status}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="max-w-7xl mx-auto p-6">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="glass-card rounded-xl p-6">
              <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                </svg>
                Site Location - Thailand
              </h2>
              <div class="map-container rounded-lg overflow-hidden relative" style="height: 400px;">
                <!-- Thailand Map background -->
                <div class="map-bg"></div>
                <div class="map-overlay"></div>
                
                <div class="battery-pin" style="left: ${x}%; top: ${y}%; animation: float 2.5s ease-in-out infinite, ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;">
                  <div class="relative">
                    ${renderBatteryPin(selectedSite)}
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-3 whitespace-nowrap">
                      <div class="glass-card rounded-lg px-4 py-2">
                        <div class="font-bold text-center text-white">${selectedSite.name}</div>
                        <div class="text-xs text-gray-300 text-center">
                          ${selectedSite.lat.toFixed(4)}°N, ${selectedSite.lng.toFixed(4)}°E
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                ${sites.filter(s => s.id !== selectedSite.id).map(site => {
                  const siteX = ((site.lng - 97) / (106 - 97)) * 100;
                  const siteY = ((20 - site.lat) / (20 - 5)) * 100;
                  const pinClass = site.status === 'good' ? 'pin-good' : 
                                   site.status === 'warning' ? 'pin-warning' : 'pin-critical';
                  return `
                    <div class="battery-pin" 
                         style="left: ${siteX}%; top: ${siteY}%; opacity: 0.6;"
                         onclick="showDetail(${site.id})">
                      <div class="pin-circle ${pinClass}" style="width: 12px; height: 12px; border-width: 2px;"></div>
                      <div class="pin-stem ${pinClass}" style="width: 2px; height: 8px;"></div>
                      <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 opacity-0 hover:opacity-100 transition-opacity pointer-events-none z-20">
                        <div class="glass-card rounded px-2 py-1 text-xs whitespace-nowrap text-white">
                          ${site.name}
                        </div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>

            <div class="glass-card rounded-xl p-6">
              <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="5" y="6" width="14" height="12" rx="2" stroke-width="2"/>
                  <path d="M12 6V2M8 2h8" stroke-width="2"/>
                </svg>
                Battery Status
              </h2>
              <div class="flex items-center justify-center h-full">
                <div class="relative">
                  <svg class="w-64 h-64 transform -rotate-90">
                    <circle cx="128" cy="128" r="112" stroke="currentColor" stroke-width="16" fill="none" class="text-slate-700"/>
                    <circle cx="128" cy="128" r="112" stroke="currentColor" stroke-width="16" fill="none" 
                      stroke-dasharray="${circumference}" 
                      stroke-dashoffset="${offset}" 
                      class="${selectedSite.battery >= 80 ? 'text-green-500' : selectedSite.battery >= 60 ? 'text-yellow-500' : 'text-red-500'}"
                      stroke-linecap="round"/>
                  </svg>
                  <div class="absolute inset-0 flex items-center justify-center flex-col">
                    <div class="${getStatusBg(selectedSite.status)} p-3 rounded-full mb-3 shadow-lg">
                      <svg class="w-12 h-12" fill="none" stroke="white" viewBox="0 0 24 24">
                        <rect x="5" y="6" width="14" height="12" rx="2" stroke-width="2"/>
                        <path d="M12 6V2M8 2h8" stroke-width="2"/>
                      </svg>
                    </div>
                    <span class="text-5xl font-bold mt-3">${selectedSite.battery}%</span>
                    <span class="text-gray-400 mt-1">State of Charge</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="glass-card rounded-xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 font-semibold">Voltage</h3>
                <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <div class="text-4xl font-bold mb-2">${selectedSite.voltage}</div>
              <div class="text-gray-400">Volts (V)</div>
            </div>

            <div class="glass-card rounded-xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 font-semibold">Current</h3>
                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
              </div>
              <div class="text-4xl font-bold mb-2">${selectedSite.current}</div>
              <div class="text-gray-400">Amperes (A)</div>
            </div>

            <div class="glass-card rounded-xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 font-semibold">Power</h3>
                <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <div class="text-4xl font-bold mb-2">${selectedSite.power}</div>
              <div class="text-gray-400">Watts (W)</div>
            </div>

            <div class="glass-card rounded-xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 font-semibold">Temperature</h3>
                <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
              </div>
              <div class="text-4xl font-bold mb-2">${selectedSite.temp}°</div>
              <div class="text-gray-400">Celsius (°C)</div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-xl p-6">
              <h3 class="text-xl font-bold mb-4">System Information</h3>
              <div class="space-y-3">
                <div class="flex justify-between py-2 border-b border-slate-700">
                  <span class="text-gray-400">Location</span>
                  <span class="font-semibold">${selectedSite.lat.toFixed(4)}°N, ${selectedSite.lng.toFixed(4)}°E</span>
                </div>
                <div class="flex justify-between py-2 border-b border-slate-700">
                  <span class="text-gray-400">Battery Type</span>
                  <span class="font-semibold">Li-ion 48V</span>
                </div>
                <div class="flex justify-between py-2 border-b border-slate-700">
                  <span class="text-gray-400">Capacity</span>
                  <span class="font-semibold">100 kWh</span>
                </div>
                <div class="flex justify-between py-2 border-b border-slate-700">
                  <span class="text-gray-400">Last Updated</span>
                  <span class="font-semibold">2 minutes ago</span>
                </div>
                <div class="flex justify-between py-2">
                  <span class="text-gray-400">Uptime</span>
                  <span class="font-semibold">99.8%</span>
                </div>
              </div>
            </div>

            <div class="glass-card rounded-xl p-6">
              <h3 class="text-xl font-bold mb-4">Recent Alerts</h3>
              <div class="space-y-3">
                ${selectedSite.status === 'critical' ? `
                  <div class="flex items-start gap-3 p-3 status-critical rounded-lg">
                    <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <div>
                      <div class="font-semibold text-red-400">Critical Battery Level</div>
                      <div class="text-sm text-gray-400">Battery below 50%, immediate attention required</div>
                      <div class="text-xs text-gray-500 mt-1">5 minutes ago</div>
                    </div>
                  </div>
                  <div class="flex items-start gap-3 p-3 status-critical rounded-lg">
                    <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <div>
                      <div class="font-semibold text-red-400">High Temperature Alert</div>
                      <div class="text-sm text-gray-400">Temperature exceeds normal range</div>
                      <div class="text-xs text-gray-500 mt-1">12 minutes ago</div>
                    </div>
                  </div>
                ` : selectedSite.status === 'warning' ? `
                  <div class="flex items-start gap-3 p-3 status-warning rounded-lg">
                    <svg class="w-5 h-5 text-yellow-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <div>
                      <div class="font-semibold text-yellow-400">Battery Level Warning</div>
                      <div class="text-sm text-gray-400">Battery below 80%, monitoring required</div>
                      <div class="text-xs text-gray-500 mt-1">15 minutes ago</div>
                    </div>
                  </div>
                ` : `
                  <div class="flex items-start gap-3 p-3 status-good rounded-lg">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <div>
                      <div class="font-semibold text-green-400">System Operating Normal</div>
                      <div class="text-sm text-gray-400">All parameters within normal range</div>
                      <div class="text-xs text-gray-500 mt-1">Updated 2 minutes ago</div>
                    </div>
                  </div>
                `}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showDetail(siteId) {
      selectedSite = sites.find(s => s.id === siteId);
      currentPage = 'detail';
      render();
    }

    function showHome() {
      currentPage = 'home';
      selectedSite = null;
      render();
    }

    function render() {
      const app = document.getElementById('app');
      app.innerHTML = currentPage === 'home' ? renderHomePage() : renderDetailPage();
    }

    // Initial render
    render();
  </script>
</body>
</html>
