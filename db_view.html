<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Battery Monitoring System - Database View</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(-45deg, #0f172a, #1e293b, #0f172a, #1e293b, #0f172a);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      position: relative;
      overflow-x: hidden;
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .glass-card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    
    .status-good {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    .status-warning {
      background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
      border: 1px solid rgba(234, 179, 8, 0.3);
    }
    
    .status-critical {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
  </style>
</head>
<body class="text-white min-h-screen p-6">
  <div class="max-w-7xl mx-auto">
    <div class="glass-card rounded-xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-2 rounded-lg shadow-lg">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 1.79 4 4 4h8c2.21 0 4-1.79 4-4V7c0-2.21-1.79-4-4-4H8c-2.21 0-4 1.79-4 4z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 7h12M6 11h12M6 15h12" />
            </svg>
          </div>
          <div>
            <h1 class="text-3xl font-bold">Battery Monitoring System - Database View</h1>
            <p class="text-gray-400">Read-only view of all monitoring data</p>
          </div>
        </div>
        <button onclick="goBack()" class="btn-enhanced flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 px-5 py-2 rounded-lg transition-all shadow-lg hover:shadow-xl">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          <span>Back to Dashboard</span>
        </button>
      </div>
    </div>

    <div class="glass-card rounded-xl p-6 overflow-x-auto">
      <h2 class="text-2xl font-bold mb-4">Database Records</h2>
      <table class="min-w-full text-sm">
        <thead class="text-gray-400 uppercase tracking-wide text-xs border-b border-slate-700">
          <tr>
            <th class="py-2 text-left">ID</th>
            <th class="py-2 text-left">Site Name</th>
            <th class="py-2 text-left">Province</th>
            <th class="py-2 text-left">Status</th>
            <th class="py-2 text-left">SoC (%)</th>
            <th class="py-2 text-left">SoH (%)</th>
            <th class="py-2 text-left">Voltage/Cell (V)</th>
            <th class="py-2 text-left">Resistance (µΩ)</th>
            <th class="py-2 text-left">Current/String (A)</th>
            <th class="py-2 text-left">Voltage/String (V)</th>
            <th class="py-2 text-left">Ambient Temp (°C)</th>
            <th class="py-2 text-left">Latitude</th>
            <th class="py-2 text-left">Longitude</th>
          </tr>
        </thead>
        <tbody id="dbTableBody">
          <!-- Data will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Get site data from sessionStorage if available, otherwise use default
    let sites = JSON.parse(sessionStorage.getItem('bmsSitesData') || '[]');
    
    // If no data from sessionStorage, use default data
    if (sites.length === 0) {
      sites = [
        { 
          id: 1, 
          name: 'สถานีไฟฟ้า เชียงราย 2', 
          lat: 19.91, 
          lng: 99.84, 
          status: 'good', 
          battery: 95, 
          temp: 28, 
          voltage: 125.0, 
          current: 332.5,
          voltagePerCell: 2.50,
          internalResistance: 2500,
          currentPerString: 332.5,
          voltagePerString: 125.0,
          stateOfCharge: 95,
          stateOfHealth: 98,
          ambientTemp: 28,
          province: 'เชียงราย' 
        },
        { 
          id: 2, 
          name: 'สถานีไฟฟ้า ลำปาง 3', 
          lat: 18.29, 
          lng: 99.49, 
          status: 'critical', 
          battery: 45, 
          temp: 32, 
          voltage: 125.0, 
          current: 157.5,
          voltagePerCell: 2.50,
          internalResistance: 4800,
          currentPerString: 157.5,
          voltagePerString: 125.0,
          stateOfCharge: 45,
          stateOfHealth: 85,
          ambientTemp: 32,
          province: 'ลำปาง' 
        },
        { 
          id: 3, 
          name: 'สถานีไฟฟ้า พิษณุโลก 6', 
          lat: 16.82, 
          lng: 100.27, 
          status: 'warning', 
          battery: 78, 
          temp: 32, 
          voltage: 125.0, 
          current: 273.0,
          voltagePerCell: 2.50,
          internalResistance: 4500,
          currentPerString: 273.0,
          voltagePerString: 125.0,
          stateOfCharge: 78,
          stateOfHealth: 85,
          ambientTemp: 32,
          province: 'พิษณุโลก' 
        },
        { 
          id: 4, 
          name: 'สถานีไฟฟ้า น่าน 1', 
          lat: 17.01, 
          lng: 99.82, 
          status: 'good', 
          battery: 90, 
          temp: 27, 
          voltage: 125.0, 
          current: 315.0,
          voltagePerCell: 2.50,
          internalResistance: 2200,
          currentPerString: 315.0,
          voltagePerString: 125.0,
          stateOfCharge: 90,
          stateOfHealth: 96,
          ambientTemp: 27,
          province: 'น่าน' 
        },
        { 
          id: 5, 
          name: 'สถานีไฟฟ้าท่าวุ้ง', 
          lat: 14.96, 
          lng: 100.87, 
          status: 'critical', 
          battery: 40, 
          temp: 35, 
          voltage: 125.0, 
          current: 140.0,
          voltagePerCell: 2.50,
          internalResistance: 5000,
          currentPerString: 140.0,
          voltagePerString: 125.0,
          stateOfCharge: 40,
          stateOfHealth: 75,
          ambientTemp: 35,
          province: 'ลพบุรี' 
        },
        { 
          id: 6, 
          name: 'สถานีไฟฟ้าชนแดน', 
          lat: 14.14, 
          lng: 101.1, 
          status: 'good', 
          battery: 88, 
          temp: 30, 
          voltage: 125.0, 
          current: 308.0,
          voltagePerCell: 2.50,
          internalResistance: 2100,
          currentPerString: 308.0,
          voltagePerString: 125.0,
          stateOfCharge: 88,
          stateOfHealth: 95,
          ambientTemp: 30,
          province: 'ชัยนาท' 
        },
        { 
          id: 7, 
          name: 'สถานีไฟฟ้า ชัยนาท', 
          lat: 15.18, 
          lng: 100.12, 
          status: 'good', 
          battery: 92, 
          temp: 29, 
          voltage: 125.0, 
          current: 322.0,
          voltagePerCell: 2.50,
          internalResistance: 2000,
          currentPerString: 322.0,
          voltagePerString: 125.0,
          stateOfCharge: 92,
          stateOfHealth: 97,
          ambientTemp: 29,
          province: 'ชัยนาท' 
        },
        { 
          id: 8, 
          name: 'สถานีไฟฟ้า อุดรธานี 3', 
          lat: 17.41, 
          lng: 102.79, 
          status: 'warning', 
          battery: 72, 
          temp: 33, 
          voltage: 125.0, 
          current: 252.0,
          voltagePerCell: 2.50,
          internalResistance: 4000,
          currentPerString: 252.0,
          voltagePerString: 125.0,
          stateOfCharge: 72,
          stateOfHealth: 82,
          ambientTemp: 33,
          province: 'อุดรธานี' 
        },
        { 
          id: 9, 
          name: 'สถานีไฟฟ้า ขอนแก่น 3', 
          lat: 16.43, 
          lng: 102.82, 
          status: 'critical', 
          battery: 45, 
          temp: 38, 
          voltage: 125.0, 
          current: 157.5,
          voltagePerCell: 2.50,
          internalResistance: 5000,
          currentPerString: 157.5,
          voltagePerString: 125.0,
          stateOfCharge: 45,
          stateOfHealth: 65,
          ambientTemp: 38,
          province: 'ขอนแก่น' 
        },
        { 
          id: 10, 
          name: 'สถานีไฟฟ้า โพนพิสัย', 
          lat: 17.9, 
          lng: 102.1, 
          status: 'good', 
          battery: 85, 
          temp: 31, 
          voltage: 125.0, 
          current: 297.5,
          voltagePerCell: 2.50,
          internalResistance: 2400,
          currentPerString: 297.5,
          voltagePerString: 125.0,
          stateOfCharge: 85,
          stateOfHealth: 94,
          ambientTemp: 31,
          province: 'บึงกาฬ' 
        },
        { 
          id: 11, 
          name: 'สถานีไฟฟ้า บรบือ', 
          lat: 15.7, 
          lng: 103.1, 
          status: 'good', 
          battery: 87, 
          temp: 32, 
          voltage: 125.0, 
          current: 304.5,
          voltagePerCell: 2.50,
          internalResistance: 2200,
          currentPerString: 304.5,
          voltagePerString: 125.0,
          stateOfCharge: 87,
          stateOfHealth: 93,
          ambientTemp: 32,
          province: 'มหาสารคาม' 
        },
        { 
          id: 12, 
          name: 'สถานีไฟฟ้า วาปีปทุม', 
          lat: 16.3, 
          lng: 103.9, 
          status: 'warning', 
          battery: 68, 
          temp: 34, 
          voltage: 125.0, 
          current: 238.0,
          voltagePerCell: 2.50,
          internalResistance: 4500,
          currentPerString: 238.0,
          voltagePerString: 125.0,
          stateOfCharge: 68,
          stateOfHealth: 80,
          ambientTemp: 34,
          province: 'อำนาจเจริญ' 
        },
        { 
          id: 13, 
          name: 'สถานีไฟฟ้า เขื่องใน', 
          lat: 15.0, 
          lng: 103.1, 
          status: 'good', 
          battery: 91, 
          temp: 30, 
          voltage: 125.0, 
          current: 318.5,
          voltagePerCell: 2.50,
          internalResistance: 2100,
          currentPerString: 318.5,
          voltagePerString: 125.0,
          stateOfCharge: 91,
          stateOfHealth: 96,
          ambientTemp: 30,
          province: 'อุบลราชธานี' 
        },
        { 
          id: 14, 
          name: 'สถานีไฟฟ้า โรจนะ 3', 
          lat: 14.37, 
          lng: 100.59, 
          status: 'good', 
          battery: 88, 
          temp: 29, 
          voltage: 125.0, 
          current: 308.0,
          voltagePerCell: 2.50,
          internalResistance: 2300,
          currentPerString: 308.0,
          voltagePerString: 125.0,
          stateOfCharge: 88,
          stateOfHealth: 94,
          ambientTemp: 29,
          province: 'พระนครศรีอยุธยา' 
        },
        { 
          id: 15, 
          name: 'สถานีไฟฟ้า โรจนะ 4', 
          lat: 14.37, 
          lng: 100.59, 
          status: 'critical', 
          battery: 42, 
          temp: 39, 
          voltage: 125.0, 
          current: 147.0,
          voltagePerCell: 2.50,
          internalResistance: 5500,
          currentPerString: 147.0,
          voltagePerString: 125.0,
          stateOfCharge: 42,
          stateOfHealth: 60,
          ambientTemp: 39,
          province: 'พระนครศรีอยุธยา' 
        },
        { 
          id: 16, 
          name: 'สถานีไฟฟ้า บางพระครู', 
          lat: 13.76, 
          lng: 100.50, 
          status: 'good', 
          battery: 90, 
          temp: 28, 
          voltage: 125.0, 
          current: 315.0,
          voltagePerCell: 2.50,
          internalResistance: 2000,
          currentPerString: 315.0,
          voltagePerString: 125.0,
          stateOfCharge: 90,
          stateOfHealth: 95,
          ambientTemp: 28,
          province: 'สมุทรปราการ' 
        },
        { 
          id: 17, 
          name: 'สถานีไฟฟ้า สมุทรสาคร 7', 
          lat: 13.5, 
          lng: 100.25, 
          status: 'good', 
          battery: 86, 
          temp: 30, 
          voltage: 125.0, 
          current: 301.0,
          voltagePerCell: 2.50,
          internalResistance: 2200,
          currentPerString: 301.0,
          voltagePerString: 125.0,
          stateOfCharge: 86,
          stateOfHealth: 93,
          ambientTemp: 30,
          province: 'สมุทรสาคร' 
        },
        { 
          id: 18, 
          name: 'สถานีไฟฟ้า สามพราน 4', 
          lat: 13.7, 
          lng: 99.95, 
          status: 'warning', 
          battery: 75, 
          temp: 31, 
          voltage: 125.0, 
          current: 262.5,
          voltagePerCell: 2.50,
          internalResistance: 4200,
          currentPerString: 262.5,
          voltagePerString: 125.0,
          stateOfCharge: 75,
          stateOfHealth: 83,
          ambientTemp: 31,
          province: 'นครปฐม' 
        },
        { 
          id: 19, 
          name: 'สถานีไฟฟ้า ถลาง 2', 
          lat: 8.1, 
          lng: 98.4, 
          status: 'good', 
          battery: 89, 
          temp: 32, 
          voltage: 125.0, 
          current: 311.5,
          voltagePerCell: 2.50,
          internalResistance: 2100,
          currentPerString: 311.5,
          voltagePerString: 125.0,
          stateOfCharge: 89,
          stateOfHealth: 94,
          ambientTemp: 32,
          province: 'ภูเก็ต' 
        },
        { 
          id: 20, 
          name: 'สถานีไฟฟ้า ภูเก็ต 3', 
          lat: 7.88, 
          lng: 98.39, 
          status: 'warning', 
          battery: 68, 
          temp: 34, 
          voltage: 125.0, 
          current: 238.0,
          voltagePerCell: 2.50,
          internalResistance: 4500,
          currentPerString: 238.0,
          voltagePerString: 125.0,
          stateOfCharge: 68,
          stateOfHealth: 82,
          ambientTemp: 34,
          province: 'ภูเก็ต' 
        },
        { 
          id: 21, 
          name: 'สถานีไฟฟ้า กระบี่ 1', 
          lat: 8.09, 
          lng: 98.91, 
          status: 'good', 
          battery: 92, 
          temp: 30, 
          voltage: 125.0, 
          current: 322.0,
          voltagePerCell: 2.50,
          internalResistance: 2000,
          currentPerString: 322.0,
          voltagePerString: 125.0,
          stateOfCharge: 92,
          stateOfHealth: 96,
          ambientTemp: 30,
          province: 'กระบี่' 
        },
        { 
          id: 22, 
          name: 'สถานีไฟฟ้า หาดใหญ่ 2', 
          lat: 7.01, 
          lng: 100.47, 
          status: 'warning', 
          battery: 70, 
          temp: 35, 
          voltage: 125.0, 
          current: 245.0,
          voltagePerCell: 2.50,
          internalResistance: 4100,
          currentPerString: 245.0,
          voltagePerString: 125.0,
          stateOfCharge: 70,
          stateOfHealth: 81,
          ambientTemp: 35,
          province: 'สงขลา' 
        },
        { 
          id: 23, 
          name: 'สถานีไฟฟ้า ฉลุง', 
          lat: 7.2, 
          lng: 100.5, 
          status: 'good', 
          battery: 88, 
          temp: 29, 
          voltage: 125.0, 
          current: 308.0,
          voltagePerCell: 2.50,
          internalResistance: 2100,
          currentPerString: 308.0,
          voltagePerString: 125.0,
          stateOfCharge: 88,
          stateOfHealth: 95,
          ambientTemp: 29,
          province: 'สตูล' 
        },
        { 
          id: 24, 
          name: 'สถานีไฟฟ้า ปัตตานี 2', 
          lat: 6.7, 
          lng: 101.25, 
          status: 'warning', 
          battery: 73, 
          temp: 33, 
          voltage: 125.0, 
          current: 255.5,
          voltagePerCell: 2.50,
          internalResistance: 3900,
          currentPerString: 255.5,
          voltagePerString: 125.0,
          stateOfCharge: 73,
          stateOfHealth: 88,
          ambientTemp: 33,
          province: 'ปัตตานี' 
        }
      ];
    }

    function getStatusClass(status) {
      switch(status) {
        case 'good': return 'status-good';
        case 'warning': return 'status-warning';
        case 'critical': return 'status-critical';
        default: return '';
      }
    }

    function populateTable() {
      const tbody = document.getElementById('dbTableBody');
      tbody.innerHTML = '';
      
      sites.forEach(site => {
        const row = document.createElement('tr');
        row.className = `${getStatusClass(site.status)} group cursor-pointer border-b border-slate-800/70 last:border-none hover:bg-slate-800/40 transition-colors`;
        row.addEventListener('click', () => {
          // Persist selected site for the detail view
          sessionStorage.setItem('bmsSelectedSiteId', String(site.id));
          // Open detail page in a new tab/window
          window.open('detail.html', '_blank');
        });
        
        row.innerHTML = `
          <td class="py-3 pr-6 font-semibold">\${site.id}</td>
          <td class="py-3 pr-6 font-semibold">\${site.name}</td>
          <td class="py-3 pr-6 font-semibold">\${site.province}</td>
          <td class="py-3 pr-6">
            <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold \${getStatusClass(site.status)}">
              <span class="w-2.5 h-2.5 rounded-full \${site.status === 'good' ? 'bg-green-500' : site.status === 'warning' ? 'bg-yellow-500' : 'bg-red-500'}"></span>
              <span class="capitalize">\${site.status}</span>
            </span>
          </td>
          <td class="py-3 pr-6 font-semibold">\${site.stateOfCharge}%</td>
          <td class="py-3 pr-6 font-semibold">\${site.stateOfHealth}%</td>
          <td class="py-3 pr-6 font-semibold">\${site.voltagePerCell} V</td>
          <td class="py-3 pr-6 font-semibold">\${site.internalResistance} µΩ</td>
          <td class="py-3 pr-6 font-semibold">\${site.currentPerString} A</td>
          <td class="py-3 pr-6 font-semibold">\${site.voltagePerString} V</td>
          <td class="py-3 pr-6 font-semibold">\${site.ambientTemp}°C</td>
          <td class="py-3 pr-6 font-semibold">\${site.lat.toFixed(4)}</td>
          <td class="py-3 pr-6 font-semibold">\${site.lng.toFixed(4)}</td>
        `;
        
        tbody.appendChild(row);
      });
    }

    function goBack() {
      // Prefer navigating back to dashboard in same tab
      window.location.href = 'index.html';
    }

    // Initialize the table when the page loads
    window.onload = populateTable;
  </script>
</body>
</html>
